<!DOCTYPE html>
<html>
<head>
	<title>UTb</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
  <script src="./keys.js"></script>
</head>
<body>


<script>
(function (global) {
  var MAX_RESULTS_PER_REQUEST = 50;

  var utb = {
    apiKey: keys.apiKey,
    clientId: keys.clientId,
    scopes: keys.scopes,

    apiLoaded: function () {
      // console.log('utb#apiLoaded');

      gapi.client.setApiKey(this.apiKey);
      setTimeout(_.bind(this.checkAuth, this), 1);
    },

    checkAuth: function (immediate) {
      // console.log('utb#checkAuth');

      if (immediate === undefined) {
        immediate = true
      }

      gapi.auth.authorize({
        client_id: this.clientId,
        scope: this.scopes,
        immediate: immediate
      }, _.bind(this.handleAuthResult, this));
    },

    handleAuthResult: function (authResult) {
      // console.log('utb#handleAuthResult');

      var authorizeButton = document.getElementById('authorize-button');
      if (authResult && !authResult.error) {
        authorizeButton.style.visibility = 'hidden';
        console.info('utb#Authorized');
        this.makePlaylist();
      } else {
        authorizeButton.style.visibility = '';
        authorizeButton.onclick = _.bind(this.handleAuthClick, this);
      }
    },

    handleAuthClick: function () {
      // console.log('utb#handleAuthResult');

      this.checkAuth(false);
      return false;
    },

    makePlaylist: function () {
      // console.log('utb#makePlaylist');

    },

    _request: function (path, params) {
      // console.log('utb#_request');

      var self = this;

      params = _.extend({
        maxResults: MAX_RESULTS_PER_REQUEST
      }, params);

      return gapi.client.request({
        'path': '/youtube/v3' + path,
        'params': params
      });
    }
  };

  global.utb = utb;
})(window);

function initialize() {
  console.info('utb#start');
  utb.apiLoaded();
}

</script>

<button id="authorize-button" style="visibility: hidden">인증</button>

<script src="https://apis.google.com/js/client.js?onload=initialize"></script>
</body>
</html>